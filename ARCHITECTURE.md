# Архитектура веб-сервиса MyHwProj

### Роли и случаи использования
Роли:
- преподаватель
- студент

Случаи использования:
- преподаватель хочет публиковать домашние задания, получать решения студента,
проверять их автоматически и смотреть результаты.
- студент хочет получать домашние задания, отправлять решения и видеть результаты
проверок.

### Диаграмма компонент
![](images/Component.jpg)
Состоит из подсистемы `Server` внутри которых находится модель (`DomainModel` и `ViewModel`), контроллеры, сервер для баз данных и сервис, который общается через `RabbitMQ` с `SolutionChecker`, который внутри тестирует задачу
### Диаграмма классов
![](images/ClassDiagram.jpg)
- `HttpServer` -- главный класс, в котором происходит запуск приложения, происходит обработка действий пользователя
- `Controller` -- интерфейс для контроллеров, который будут обрабатывать действия пользователя.
   - `applyConfiguration(ServerContext)` -- метод для регистрации обработчиков по url
- `StudentRestController` и `StudentViewController` -- контроллеры для обработки действий студентов. Первый нужен для обработки rest-запросов, второй нужен для отрисовки. 
Во втором случае после выполнения метода возвращается HTML-файл, в первом же ORM сущности. 
Методы могут отображать страницу с одним дз (`getHomeworkPage`), список дз (`getHomeworksPage`), список решений (`getSubmissionPage`)
Так же есть метод для добавления нового решения (`postSubmission`)
- `TeacherRestController` и `TeacherViewController` -- аналогичные контроллеры для учителей, теперь есть метод для добавления дз (`postHomework`) и добавления решения к конкретному дз (`postChecker`)
- `StudentViewService` и `TeacherViewService` -- часть модели, которые общаются с соответствующими контроллерами и переадресуют свои запросы более общим Service
- `StudentService` и `TeacherService` -- часть модели, обрабатывают все запросы от пользователей. Общаются с сервисом базы данных: достать из нее что-то, положить новое добавленное дз и так далее.
`StudentService` так же выполняет метод `submit`, который помимо сохранения нового решения в базу данных передает это решение в `CheckerService` для автоматической проверки.
- `CheckerService` в методе `check` достает из базы данных саму задачу и чекеры к ней, после чего добавляет в очередь эту задачу вместе с чекером, условием и решением. 
- `DbService` общается с базой данных, добавляет/достает объекты
- `RabbitMQConsumer` -- `consumer` в терминах `RabbitMQ`. Он запускает внутри себя обработчики конкретной очереди. 
- `Runner` -- сам обработчик, принимает все необходимое и проверяет решение, возвращает результат. 
Таким образом, чтобы добавить свой чекер учителю надо выбрать задачу и передавать в виде текста bash скрипт, через методы `postSubmission` он сохранится в базе данных, а дальше все 
чекеры к конкретной задаче будут внутри `Runner` превращены в исполняемый код и запущены на решении
### ER-диаграмма 
Перейдем теперь к диаграмме, которая описывает сущности `Homework`, `Submission` и т д из предыдущего пункта
![](images/ErDiagram.jpg)
Тут описаны сущности и связи, которые хранятся в базе данных. Как видно, чекер -- это просто строчка bash скрипта